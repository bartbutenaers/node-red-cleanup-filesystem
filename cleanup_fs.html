<script type="text/javascript">
    RED.nodes.registerType('cleanup-filesystem', {
        category: 'function',
        color: '#a6bbcf',
        defaults: {
            name: {value: ""},
            baseFolder: {value: ""},
            fileNamePattern: {value: ".*"},
            folderNamePattern: {value: ".*"},
            age: {value: ""},
            ageUnit: {value: "minutes"},
            removeEmptyFolders: {value: false},
            dryRun: {value: true},
            report: {value: false}
        },
        inputs: 1,
        outputs: 1,
        icon: "font-awesome/fa-trash",
        label: function() {
            return this.name || "Cleanup filesystem";
        },
        oneditprepare: function() {
            // Custom logic goes here
        }
    });
</script>

<script type="text/html" data-template-name="cleanup-filesystem">
    <div class="form-row">
        <label for="node-input-name"><i class="icon-tag"></i> Name</label>
        <input type="text" id="node-input-name" placeholder="Name">
    </div>
    <div class="form-row">
        <label for="node-input-baseFolder"><i class="fa fa-download"></i> Base folder</label>
        <input type="text" id="node-input-baseFolder" placeholder="Base Folder">
    </div>
    <div class="form-row">
        <label for="node-input-fileNamePattern"><i class="fa fa-file"></i> Filename</label>
        <input type="text" id="node-input-fileNamePattern" placeholder="File Name Patterns (semicolon separated)">
    </div>
    <div class="form-row">
        <label for="node-input-folderNamePattern"><i class="fa fa-folder"></i> Foldername</label>
        <input type="text" id="node-input-folderNamePattern" placeholder="Folder Name Patterns (semicolon separated)">
    </div>
    <div class="form-row">
        <label for="node-input-age"><i class="fa fa-clock-o"></i> Age</label>
        <input type="number" id="node-input-age" placeholder="Age" min="1" step="1" style="width:100px; margin-right:5px">
        <select id="node-input-ageUnit" style="width:max-content;">
            <option value="minutes">Minutes</option>
            <option value="hours">Hours</option>
            <option value="days">Days</option>
            <option value="weeks">Weeks</option>
            <option value="months">Months</option>
            <option value="years">Years</option>
        </select>
    </div>
    <div class="form-row">
        <label for="node-input-removeEmptyFolders"><i class="fa fa-trash"></i> Subfolders</label>
        <input type="checkbox" id="node-input-removeEmptyFolders" style="width:auto ;border:none; vertical-align:baseline;">
        <span for="node-input-removeEmptyFolders"> Remove empty subfolders</span>
    </div>
    <div class="form-row">
        <label for="node-input-dryRun"><i class="fa fa-exclamation-triangle"></i> Dry run</label>
        <input type="checkbox" id="node-input-dryRun" style="width:auto ;border:none; vertical-align:baseline;">
        <span for="node-input-dryRun"> Do a test run (without deleting files or folders)</span>
    </div>
    <div class="form-row">
        <label for="node-input-report"><i class="fa fa-list-alt"></i> Report</label>
        <input type="checkbox" id="node-input-report" style="width:auto ;border:none; vertical-align:baseline;">
        <span for="node-input-report"> Report files and folders (in output msg)</span>
    </div>
</script>

<script type="text/html" data-help-name="cleanup-filesystem">
    <p>A Node-RED node that deletes files older than a specified age from a given folder structure.</p>
    <p><strong>Base folder:</strong><br/>The root directory where the node starts its operations. It should be a valid path on your system.</p>
    <p><strong>Filename:</strong><br/> Files with a name matching this regex pattern will be removed.  Use <code>.*</code> for all files.  Multiple regex patterns can be entered <code>;</code> separated.</p>
    <p><strong>Foldername:</strong><br/> Folders with a name matching this regex pattern will be removed.  Use <code>.*</code> for all folders.  Multiple regex patterns can be entered <code>;</code> separated.</p>
    <p><strong>Age:</strong><br/> Files older than this age will be removed.</p>
    <p><strong>Subfolders:</strong><br/> When selected, empty subfolders will be removed.</p>
    <p><strong>Dry run:</strong><br/> When selected, a test run will be executed without removing files or folders.</p>
    <p><strong>Report:</strong><br/> When selected, the paths of the (to be) deleted files and folders will be send in the output <code>payload.report</code>.</p>
    <p>Please ensure to specify all these parameters either in the config screen or in the input message payload.</p>
</script>
